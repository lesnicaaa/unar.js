!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Unar=e()}(this,function(){"use strict";var t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},n=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),i=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],i=!0,r=!1,o=void 0;try{for(var u,s=t[Symbol.iterator]();!(i=(u=s.next()).done)&&(n.push(u.value),!e||n.length!==e);i=!0);}catch(t){r=!0,o=t}finally{try{!i&&s.return&&s.return()}finally{if(r)throw o}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),r=function(t,e){try{return new Function("vm","with(vm){return "+t+"}")(e)}catch(e){console.error(t+" has a unresolved error")}},o={listener:null};window.listener=o;var u={actionPrefix:"u-",attrPrefix:":",evtPrefix:"@"},s=0,a=function(){function t(n,i,o){e(this,t),this.id=++s,this.exp=i,this.vm=n,this.oldVal=r(this.exp,this.vm),this.cb=o}return n(t,[{key:"update",value:function(){var t=r(this.exp,this.vm);this.cb.call(this.vm,t,this.oldVal),this.oldVal=t}}]),t}(),c=function(e){var n;return("object"==(n=void 0===e?"undefined":t(e))?Object.prototype.toString.call(e).slice(8,-1):n).toLowerCase()},l=[];window.hubs=l;var f=function(){function t(n){e(this,t),this.key=n,this.listeners={}}return n(t,[{key:"addListener",value:function(t){var e=t.id;e in this.listeners||(this.listeners[e]=t)}},{key:"notify",value:function(){for(var t in this.listeners)this.listeners[t].update()}}]),t}(),d=function(t,e){!function t(e,n){Object.keys(e).forEach(function(i){var r=new f(i);l.push(r);var u=e[i];Object.defineProperty(e,i,{get:function(){return o.listener&&r.addListener(o.listener),console.log("accessor->get:"+i),u},set:function(e){u=e,"object"===c(e)&&t(e,n,path),r.notify()}}),"object"===c(u)&&t(u,n,path)})}(t,e),function(t,e){Object.keys(t).forEach(function(n){Object.defineProperty(e,n,{get:function(){return console.log("hijack->get:"+n),t[n]},set:function(e){t[n]=e}})})}(t,e)},h=function(){function t(){e(this,t)}return n(t,null,[{key:"isExpression",value:function(t){return/\{\{.*\}\}/.test(t)}},{key:"expressionKey",value:function(t){return t.match(/(.*)\{\{(.*)\}\}(.*)/)}},{key:"isRightDetec",value:function(t,e){var n;for(var i in e)if(t.startsWith(e[i])){n={detectype:t.substring(0,e[i].length),detec:t.substring(e[i].length)};break}return n}}]),t}(),v=function(){function t(){e(this,t)}return n(t,null,[{key:"bind",value:function(t,e,n,i){n!==i&&(t[e]=n)}},{key:"addEvt",value:function(t,e,n){t.addEventListener(e,n,!1)}}]),t}(),y=function(){function t(){e(this,t)}return n(t,null,[{key:"registDomListener4Hubs",value:function(t,e,n,i,r,u){var s=function(n,i){v.bind(t,e,r+n+u,r+i+u)};o.listener=new a(i,n,s),s(function(t,e){try{return new Function("vm","with(vm){return "+t+"}")(e)}catch(e){console.error(t+" has a unresolved error")}}(n,i)),o.listener=null}}]),t}(),p=function(){function t(){e(this,t)}return n(t,null,[{key:"bind",value:function(t,e,n,i){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";if(y.registDomListener4Hubs(t,e,n,i,r,o),"value"===e){this.addEvt(t,"input",function(t){return i[n]=t.target.value},i)}}},{key:"addEvt",value:function(t,e,n,i){var r="function"==typeof n?n:i.methods[n].bind(i);v.addEvt(t,e,r)}}]),t}(),b=function(){function t(n,i){e(this,t),this.vm=i,this.el=document.querySelector(n),this.el.appendChild(this.init())}return n(t,[{key:"init",value:function(){var t=this,e=document.createDocumentFragment();return this.translate(e).childNodes.forEach(function(e){t.initAttr(e)}),e}},{key:"translate",value:function(t){for(var e=0;e<this.el.childNodes.length;e++){var n=this.el.childNodes[e];this.isValidType(n)&&(t.appendChild(n),--e)}return t}},{key:"initAttr",value:function(t){var e=this,n={model:"value",html:"innerHTML",text:"textContent",class:"className"};if(1===t.nodeType)return(new Array).slice.call(t.attributes).forEach(function(i){var r=i.nodeName,o=i.nodeValue,u=h.isRightDetec(r,e.vm.configs),s=u||{detectype:void 0,detec:void 0},a=s.detectype,c=s.detec;if(c){t.removeAttribute(r);var l=n[c]?n[c]:c;a===e.vm.configs.evtPrefix?p.addEvt(t,l,o,e.vm):p.bind(t,l,o,e.vm)}}),void t.childNodes.forEach(function(t){e.initAttr(t)});if(3===t.nodeType&&h.isExpression(t.data)){var r=h.expressionKey(t.data),o=i(r,4),u=o[1],s=o[2],a=o[3];p.bind(t,n.text,s,this.vm,u,a)}}},{key:"isValidType",value:function(t){return 1===t.nodeType||8===t.nodeType||3===t.nodeType&&!this.isPureBlankNode(t)}},{key:"isPureBlankNode",value:function(t){return!/[^\t\n\r ]/.test(t.data)}}]),t}();return function t(n){var s=n.el,l=void 0===s?"":s,f=n.data,h=void 0===f?{}:f,v=n.computeds,y=void 0===v?{}:v,p=n.methods,m=void 0===p?{}:p,g=n.watchers,k=void 0===g?{}:g,w=n.configs;e(this,t),this.methods=m,function(t,e){e.configs=Object.assign(u,t)}(w,this),d(h,this),this.computeds=y,function(t,e){var n=!0,r=!1,o=void 0;try{for(var u,s=Object.entries(t)[Symbol.iterator]();!(n=(u=s.next()).done);n=!0){var a=u.value,l=i(a,2),f=l[0],d=l[1];Object.defineProperty(e,f,{configurable:!1,enumerable:!0,get:"function"===c(d)?d:"object"===c(d)?d.get:function(){},set:"object"===c(d)?d.set:function(){}})}}catch(t){r=!0,o=t}finally{try{!n&&s.return&&s.return()}finally{if(r)throw o}}}(y,this),this.watchers=k,function(t,e){var n=!0,u=!1,s=void 0;try{for(var c,l=Object.entries(t)[Symbol.iterator]();!(n=(c=l.next()).done);n=!0){var f=c.value,d=i(f,2),h=d[0],v=d[1];o.listener=new a(e,h,v),r(h,e),o.listener=null}}catch(t){u=!0,s=t}finally{try{!n&&l.return&&l.return()}finally{if(u)throw s}}}(k,this),new b(l,this)}});
